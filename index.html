<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Page</title>
  
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  
</head>
<body>
  <h1>Product Details</h1>
  <div id="product-details">
    <h2 id="product-name"></h2>
    <p id="product-description"></p>
    <p id="product-price"></p>
    <p id="product-ingredients"></p>
    <p id="product-delivery-fee"></p>
    <p id="product-stock"></p>
    <img id="product-image" src="" alt="Product Image">
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDBrqLoCgaSxTFRfggG5pyrWgpm9RD8pZs",
      authDomain: "sawaddimartapp-57822.firebaseapp.com",
      projectId: "sawaddimartapp-57822",
      storageBucket: "sawaddimartapp-57822.appspot.com",
      messagingSenderId: "749614159452",
      appId: "1:749614159452:android:ca1270231a131638267899"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Get product ID from the URL using URLSearchParams
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('productId'); // Retrieve 'productId' from URL query params
    const collectionName = "Food"; // You can dynamically change this based on your category

    if (!productId) {
      document.getElementById("product-details").innerText = "Product ID is missing in the URL!";
    } else {
      // Fetch product details from Firestore using productId
      db.collection("collections").doc(collectionName).collection('products').doc(productId).get().then((doc) => {
        if (doc.exists) {
          const productData = doc.data();
          document.getElementById("product-name").innerText = productData.title;
          document.getElementById("product-description").innerText = productData.description;
          document.getElementById("product-price").innerText = `Price: RM ${productData.price}`;
          document.getElementById("product-ingredients").innerText = `Ingredients: ${productData.ingredients}`;
          document.getElementById("product-stock").innerText = `Stock: ${productData.stock}`;
          document.getElementById("product-delivery-fee").innerText = `West Malaysia Delivery Fee: RM ${productData.westMalaysiaDeliveryFee || "N/A"}`;

          // Set product image (if exists)
          const productImage = productData.images && productData.images.length > 0 ? productData.images[0] : '';
          if (productImage) {
            document.getElementById("product-image").src = productImage;
          }
        } else {
          document.getElementById("product-details").innerText = "No such product found!";
        }
      }).catch((error) => {
        console.error("Error fetching product:", error);
        document.getElementById("product-details").innerText = "Error fetching product details.";
      });
    }
  </script>
</body>
</html>
